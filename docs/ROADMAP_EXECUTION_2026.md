# Дорожная карта исполнения 2026 (детализированные шаги)

Этот документ — “как именно делаем”, дополняет `ROADMAP.md` (что делаем) и
`STRATEGIC_ROADMAP_2026.md` (зачем делаем).

## Принципы планирования

- **Безопасность и воспроизводимость сборки** до масштабирования.
- **Retention раньше монетизации** (но монетизация появляется как “порог” после
  ценности).
- **Одна большая цель на спринт**, остальное — мелкие улучшения.

## Фаза 0 — Фундамент (январь 2026)

### 0.1 Единый стандарт env и сборки (готово)

- [x] Привести Gemini env к `VITE_GEMINI_API_KEY` (с back‑compat
      `GEMINI_API_KEY`)
- [x] Обновить README внутри WEB/APP

### 0.2 Минимальная безопасность контента (готово)

- [x] Санитизация HTML в Blog (WEB/APP) через DOMPurify allowlist

### 0.3 Вынести Gemini в Edge/Proxy (ключевой следующий шаг)

- [ ] Supabase Edge Function `gemini-proxy`
- [ ] Server secret: `GEMINI_API_KEY`
- [ ] Rate limit + логирование расходов
- [ ] Миграция клиентов на proxy

Фактическое состояние (сделано в репозитории):

- [x] `supabase/functions/gemini-proxy/index.ts` добавлен
- [x] WEB/APP сначала вызывают proxy (`/functions/v1/gemini-proxy`), затем
      fallback на client key
- [x] Rate limit по user_id (если есть JWT) иначе по IP
- [x] Дорогие операции требуют аутентификации (иначе `401`)

Деплой/секреты: см. `supabase/functions/README.md`

## Фаза 1 — Идентичность и доверие (февраль 2026)

- [ ] Supabase Auth (OTP/Email) в APP
- [ ] Профиль: `user_id` → все персональные данные привязаны к `auth.users`
- [ ] RLS политики для таблиц: `profiles`, `bookings`, будущие `subscriptions`

Примечание: базовый OTP‑вход по телефону уже добавлен в UI профиля APP, но
требует включённого Supabase Phone Auth и корректной настройки проекта.

## Фаза 2 — Retention‑ядро (март–апрель 2026)

- [ ] Onboarding‑quiz (цели/уровень/время/ограничения)
- [ ] Streak + мягкие напоминания
- [ ] Weekly recap
- [ ] “Практика дня” (эвристика → позже AI)

## Фаза 3 — Монетизация (май–июнь 2026)

- [ ] Подписки (RU: YooKassa; при необходимости global: Stripe)
- [ ] Paywall, тарифы, лимиты AI по тарифам
- [ ] Платёжные webhooks + таблицы `subscriptions`

## Фаза 4 — Контент и масштабирование (июль–сентябрь 2026)

- [ ] Декомпозиция больших компонентов:
  - WEB `ChatWidget.tsx` (~700 строк)
  - APP `ChatWidget.tsx` (~818 строк)
- [ ] Performance (LCP/CLS, lazy‑loading, оптимизация изображений)
- [ ] Наблюдаемость (Sentry + базовая продуктовая аналитика событий)

## Фаза 5 — Экосистема (октябрь–декабрь 2026)

- [ ] Studio OS: расписание/абонементы/CRM‑контуры
- [ ] Коммьюнити: челленджи, безопасный шэринг
- [ ] Исследование B2B и Inside Flow RU‑хаба
